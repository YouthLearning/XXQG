const t=t=>t in chrome;function e(t){return t<10?`0${t}`:`${t}`}function n(...t){o("dodgerblue",...t)}function o(t,...n){const o=n.map((t=>!(t instanceof Function)&&t instanceof Object?t instanceof Error?t.stack:JSON.stringify(t):String(t))).join(" ");console.log(`%c[${function(t=Date.now()){const n=new Date(t),o=n.getSeconds(),i=n.getMinutes(),c=n.getHours(),s=n.getDate(),r=n.getMonth()+1;return`${[n.getFullYear(),r,s].map(e).join("-")} ${[c,i,o].map(e).join(":")}`}()}] %c${o}`,"",`color: ${t}`)}let i=null;const c=()=>{["storage","scripting","notifications","cookies","debugger","contextMenus"].filter((e=>{const n=t(e);var i,c;return n||(!function(...t){o("red",...t)}(`权限: ${e} 不支持!`),i=`权限: ${e} 不支持!`,chrome.notifications.create({iconUrl:"../assets/icon.jpg",title:"提示",type:"basic",message:i,...c})),n}))},s=async()=>{if(!t("windows"))return;if(!t("tabs"))return;if(null===i){const t=chrome.runtime.getURL("/dist/popup/index.html"),[e]=await chrome.tabs.query({url:t});console.log("url",t,e),e&&(n("已存在任务面板!"),i=e.windowId)}if(null!==i)return void await chrome.windows.update(i,{focused:!0,drawAttention:!0});const e=await chrome.windows.create({type:"popup",width:250,height:700,url:"/dist/popup/index.html",focused:!0});i=e.id,e.tabs&&await chrome.tabs.update(e.tabs[0].id,{active:!0,autoDiscardable:!1})};chrome.runtime.onInstalled.addListener((()=>{n("安装成功!"),c(),(()=>{if(!t("contextMenus"))return;const e="taskPanel";chrome.contextMenus.create({title:"任务面板",id:e});const n=["https://www.xuexi.cn/","https://www.xuexi.cn/index.html"];chrome.contextMenus.onClicked.addListener((t=>{const{menuItemId:o,pageUrl:i}=t;o===e&&n.includes(i)&&s()}))})()})),chrome.windows.onRemoved.addListener((t=>{null!==i&&t===i&&(n("关闭面板"),i=null)})),chrome.action.onClicked.addListener(function(t,e){let n=-1;return function(...o){-1!==n&&clearTimeout(n),n=setTimeout((()=>{t.apply(this,o)}),e)}}(s,300)),chrome.tabs.onUpdated.addListener(((t,e,o)=>{n(t);"complete"===e.status&&["https://www.xuexi.cn/","https://www.xuexi.cn/index.html"].includes(o.url)&&s()}));
