var e,t,n,o;let i;!function(e){e[e.VIDEO_MUTED=0]="VIDEO_MUTED",e[e.RANDOM_EXAM=1]="RANDOM_EXAM",e[e.AUTO_ANSWER=2]="AUTO_ANSWER",e[e.REMOTE_PUSH=3]="REMOTE_PUSH"}(e||(e={})),function(e){e[e.LOGIN=0]="LOGIN",e[e.READ=1]="READ",e[e.WATCH=2]="WATCH",e[e.PRACTICE=3]="PRACTICE"}(t||(t={})),function(e){e[e.LOADING=0]="LOADING",e[e.START=1]="START",e[e.PROGRESS=2]="PROGRESS",e[e.PAUSE=3]="PAUSE",e[e.FINISH=4]="FINISH"}(n||(n={})),function(e){e[e.READ=0]="READ",e[e.WATCH=1]="WATCH"}(o||(o={}));const r=new WeakMap,a=new WeakMap,s=e=>{if(!i)return;let t=r.get(e);if(!t){t=new Map;const n=new Set;return n.add(i),t.set("value",n),void r.set(e,t)}let n=t.get("value");if(!n)return n=new Set,n.add(i),t.set("value",n),void r.set(e,t);n.add(i)};function u(e,t,n,o){if(!a.get(e))return;const i=r.get(e);if(!i)return;let s=i.get(t);if(s)for(const e of s)e(n,o)}var c;!function(e){e.IS_REF="_isRef",e.IS_SHALLOW="_isShallow",e.IS_REACTIVE="_isReactive",e.IS_READONLY="_isReadonly"}(c||(c={}));class d{_isShallow=!1;_isRef=!0;_value;value;constructor(e,t=!1){const n=this;if(this._isShallow=t,e&&"object"==typeof e&&t){const t=w(e);this._value=t,this.value=e}else this._value=e,this.value=e;Object.defineProperty(this,"value",{get(){return s(this),n._value},set(e){const t=this._value;t!==e&&(n._value=e,function(e,t,n){const o=r.get(e);if(!o)return;let i=o.get("value");if(i)for(const e of i)e instanceof Function&&e(t,n)}(this,e,t))}})}toJSON(){return this._value}}const f=e=>!(!e||!e[c.IS_REF]),l=(e,t)=>new d(e,t),v=e=>f(e)?e.value:e,m=e=>f(e)?e:l(e,!0),p=e=>f(e)?e:l(e,!1),h=(e,t)=>function(n,o,s){if(o===c.IS_REACTIVE)return!e;if(o===c.IS_READONLY)return e;if(o===c.IS_SHALLOW)return t;const u=Reflect.get(n,o,s);return e||((e,t)=>{if(!i)return;if(!a.get(e))return;let n=r.get(e);if(!n){n=new Map;const o=new Set;return o.add(i),n.set(t,o),void r.set(e,n)}let o=n.get(t);if(!o)return o=new Set,o.add(i),n.set(t,o),void r.set(e,n);o.add(i)})(n,o),t?u:f(u)?u.value:u&&"object"==typeof u?u instanceof Element?u:e?E(u):w(u):u},y=(e,t)=>function(n,o,i,r){if(e)return!1;const a=n[o];if(b(a)&&f(a)&&!f(i))return!1;if(!t&&f(a)&&!f(i))return a.value=i,!0;const s=Reflect.set(n,o,i,r);return Array.isArray(n)&&"length"===o?(u(n,o,i,a),s):(a!==i&&u(n,o,i,a),s)},M=(e,t,n)=>{const o=a.get(e);if(o)return o;const i=new Proxy(e,((e,t)=>({get:h(e,t),set:y(e,t)}))(t,n));return a.set(e,i),i},b=e=>!(!e||!e[c.IS_READONLY]),g=e=>{return!(!(t=e)||!t[c.IS_REACTIVE])||b(e);var t},w=e=>(e=>M(e,!1,!1))(e),E=e=>(e=>M(e,!0,!1))(e),D=(e,t,n=!1)=>{if(n&&t(v(e),v(e)),Array.isArray(e)&&e.every((e=>f(e)))){for(const n in e)g(e[n])&&D(e[n],(()=>{const n=e.map((e=>v(e)));t(n,n)}));D((()=>e.map((e=>v(e)))),t)}else if(e instanceof Function)D(P(e),((e,n)=>{t(v(e),v(n))}));else{if(!g(e))return f(e)?(g(e.value)&&D(e.value,(()=>{t(v(e),v(e))})),i=t,s(e),void(i=void 0)):void 0;for(const n in e){i=()=>{t(e,e)};const o=e[n];i=void 0,D(o,(()=>{t(e,e)}))}}},A=e=>{i=e,e(),i=void 0},S=(e,t)=>{const n=p(t());return D(e,(()=>n.value=v(t()))),n},P=e=>{const t=p(void 0);return A((()=>t.value=v(e()))),t};function R(e,t,n,o,i){const r=m(!1),a=m(!1),s=m(!1),u=m(!1),{onCreated:c,beforeCreat:d,onMounted:l,beforeMount:v,beforeDestroy:p,onDestroyed:h}=i||{},y=e=>{const{onMounted:t,beforeMount:n,beforeDestroy:o,onDestroyed:i}=e;n&&D(r,(()=>{r.value&&n()}),!0),t&&D(a,(()=>{a.value&&t()}),!0),o&&D(s,(()=>{s.value&&o()}),!0),i&&D(u,(()=>{u.value&&i()}),!0)};d&&d();const M=document.createElement(e);!function(e,t){for(const n in t)if(f(t[n])){const o=t[n];A((()=>e[n]=o.value))}else e[n]=t[n]}(M,t),function(e,t,n,o){if(t)for(const o in t)_(e,o,t[o],n)}(M,n,y),function(e,t,n,o){if(f(t)){const i=document.createComment("");if(D(t,(async(t,r)=>{if(t||!r)if(t){if(r){if(r instanceof Promise){const e=await r;e&&e.forEach((e=>{o&&o(e),e.beforeDestroy&&e.beforeDestroy()}))}r instanceof Promise||r.forEach((e=>{o&&o(e),e.beforeDestroy&&e.beforeDestroy()}))}if(t instanceof Promise){const o=await t;if(o){const t=o.map((e=>((e.beforeMount||e.onMounted)&&n&&n(e),e.ele)));e.replaceChildren(O(t))}return}const i=t.map((e=>((e.beforeMount||e.onMounted)&&n&&n(e),e.ele)));if(e.replaceChildren(O(i)),r){if(r instanceof Promise){const e=await r;e&&e.forEach((e=>{e.onDestroyed&&e.onDestroyed()}))}r instanceof Promise||r.forEach((e=>{e.onDestroyed&&e.onDestroyed()}))}}else;else{if(r instanceof Promise){const e=await r;e&&e.forEach((e=>{o&&o(e),e.beforeDestroy&&e.beforeDestroy()}))}if(r instanceof Promise||r.forEach((e=>{o&&o(e),e.beforeDestroy&&e.beforeDestroy()})),e.replaceChildren(i),r instanceof Promise){const e=await r;e&&e.forEach((e=>{e.onDestroyed&&e.onDestroyed()}))}r instanceof Promise||r.forEach((e=>{e.onDestroyed&&e.onDestroyed()}))}})),t.value instanceof Promise)return e.appendChild(i),void t.value.then((t=>{if(t){const o=t.map((e=>((e.beforeMount||e.onMounted)&&n&&n(e),e.ele)));e.replaceChildren(O(o))}}));if(t.value){const o=t.value.map((e=>((e.beforeMount||e.onMounted)&&n&&n(e),e.ele)));return void e.appendChild(O(o))}return void e.appendChild(i)}if(t instanceof Promise){const o=document.createComment("");return e.appendChild(o),void t.then((e=>{if(e){const{beforeMount:t,onMounted:i}=e;(t||i)&&n&&n(e),o.replaceWith(e.ele)}}))}if(Array.isArray(t)){const i=[];for(const e in t){const r=t[e];if(f(r)){const t=document.createComment("");if(D(r,(async(e,i)=>{if(e||!i)if(!e||i){if(e&&i){if(e instanceof Promise&&i instanceof Promise){return void C(await e,await i,t,n,o)}if(e instanceof Promise&&!(i instanceof Promise)){return void C(await e,i,t,n,o)}if(!(e instanceof Promise)&&i instanceof Promise){return void C(e,await i,t,n,o)}if(!(i instanceof Promise||e instanceof Promise))return void C(e,i,t,n,o)}}else{if(e instanceof Promise){const r=await e;return void(r&&C(r,i,t,n,o))}C(e,i,t,n,o)}else{if(i instanceof Promise){const r=await i;return void(r&&C(e,r,t,n,o))}C(e,i,t,n,o)}})),r.value instanceof Promise){i[e]={ele:t},r.value.then((e=>{if(e){const{beforeMount:o,onMounted:i}=e;(o||i)&&n&&n(e),t.replaceWith(e.ele)}}));continue}if(r.value){const{beforeMount:t,onMounted:n,ele:o}=r.value;i[e]={ele:o,beforeMount:t,onMounted:n};continue}i[e]={ele:t}}else if(r instanceof Promise){const t=document.createComment("");i[e]={ele:t},r.then((e=>{if(e){const{beforeMount:o,onMounted:i}=e;(o||i)&&n&&n(e),t.replaceWith(e.ele)}}))}else if(r){const{beforeMount:t,onMounted:n,ele:o}=r;i[e]={ele:o,beforeMount:t,onMounted:n}}}const r=i.map((e=>((e.beforeMount||e.onMounted)&&n&&n(e),e.ele)));return void e.appendChild(O(r))}if(t){const{beforeMount:o,onMounted:i}=t;return(o||i)&&n&&n(t),void e.appendChild(t.ele)}}(M,o,y,(e=>{}));return c&&c(),{ele:M,beforeMount:()=>{r.value=!0,v&&v()},onMounted:()=>{a.value=!0,l&&l()},beforeDestroy:()=>{s.value=!0,p&&p()},onDestroyed:()=>{u.value=!0,h&&h()}}}function _(e,t,n,o,i){const r=t.toLowerCase();if(r.startsWith("on")){const[t]=r.match(/(?<=on).*/);if(t){const[o,...i]=t.split("_"),r=function(e){if(e.length)return{capture:e.includes("capture"),once:e.includes("once"),passive:e.includes("passive")}}(i);if(f(n)){const t=n,a=S(t,(()=>t.value?e=>{i.includes("prevent")&&e.preventDefault(),i.includes("stop")&&e.stopPropagation();(0,t.value)(e)}:void 0));return a.value&&e.addEventListener(o,a.value,r),void D(a,((t,n)=>{n&&e.removeEventListener(o,n),t&&e.addEventListener(o,t,r)}))}n instanceof Function&&e.addEventListener(o,n,r)}return}if(["checked","selected","disabled","enabled"].includes(r)){if(f(n)){const t=n;return void A((()=>{t.value?e.setAttribute(r,""):e.removeAttribute(r)}))}n?e.setAttribute(r,""):e.removeAttribute(r)}else if("ref"!==t)if(t.startsWith("xlink:")){const o="http://www.w3.org/1999/xlink";n?e.setAttributeNS(o,t,n):e.removeAttributeNS(o,t)}else if(t&&f(n)){const o=n;A((()=>{e.setAttribute(t,o.value)}))}else t&&e.setAttribute(t,n);else{if(f(n)){const t=n;return void(o&&o({onMounted(){t.value=e}}))}if(n instanceof Function){const t=n;return void(o&&o({onMounted(){t(e)}}))}}}function C(e,t,n,o,i){if(e&&t){const{beforeMount:n,onMounted:i}=e;return(n||i)&&o&&o(e),t.beforeDestroy&&t.beforeDestroy(),t.ele.replaceWith(e.ele),void(t.onDestroyed&&t.onDestroyed())}if(e&&!t){const{beforeMount:t,onMounted:i}=e;return(t||i)&&o&&o(e),void n.replaceWith(e.ele)}if(!e&&t)return i&&i(t),t.beforeDestroy&&t.beforeDestroy(),t.ele.replaceWith(n),void(t.onDestroyed&&t.onDestroyed())}function I(e,t=document){return Array.from(t.querySelectorAll(e))}function L(e,t=document,n){return new Promise((o=>{const i=setInterval((()=>{const n=Array.from(t.querySelectorAll(e));n.length&&(clearInterval(i),o(n))}),10);n&&setTimeout((()=>{clearInterval(i),o([])}),n)}))}function O(e){const t=document.createDocumentFragment();for(const n in e)t.appendChild(e[n]);return t}function T(e){return e<10?`0${e}`:`${e}`}function W(...e){!function(e,...t){const n=t.map((e=>!(e instanceof Function)&&e instanceof Object?e instanceof Error?e.stack:JSON.stringify(e):String(e))).join(" ");console.log(`%c[${function(e=Date.now()){const t=new Date(e),n=t.getSeconds(),o=t.getMinutes(),i=t.getHours(),r=t.getDate(),a=t.getMonth()+1;return`${[t.getFullYear(),a,r].map(T).join("-")} ${[i,o,n].map(T).join(":")}`}()}] %c${n}`,"",`color: ${e}`)}("dodgerblue",...e)}async function H(e,t){const{data:n,type:o}=t;return"tab"===o?await chrome.tabs.sendMessage(t.id,{data:n,action:e}):"runtime"===o?await chrome.runtime.sendMessage({data:n,action:e}):void 0}function N(e,t,n){const{once:o}=n||{},i=(n,i,a)=>{const{action:s,data:u}=n;if(s&&e===s)return t(u,i,a),void(o&&r())},r=()=>{chrome.runtime.onMessage.removeListener(i)};return chrome.runtime.onMessage.addListener(i),r}function x(){const e=m(0),t=m(0),n=Object.entries({width:"20px",height:"20px",position:"absolute",transform:"translate(-50%, -50%)",background:"#00000050","border-radius":"50%","z-index":"9999","pointer-events":"none",border:"2px solid #00000050"}).map((e=>`${e[0]}: ${e[1]};`)).join(""),o=R("div",void 0,{style:P((()=>`left: ${e.value}px;top: ${t.value}px;${n}`))},void 0,{onMounted(){const{x:n,y:o}=function(){const e=m(0),t=m(0);return window.addEventListener("mousedown",(n=>{e.value=n.pageX,t.value=n.pageY}),{passive:!0}),window.addEventListener("mousemove",(n=>{e.value=n.pageX,t.value=n.pageY}),{passive:!0}),window.addEventListener("mouseup",(n=>{e.value=n.pageX,t.value=n.pageY}),{passive:!0}),window.addEventListener("wheel",(n=>{e.value=n.pageX,t.value=n.pageY}),{passive:!0}),{x:e,y:t}}();A((()=>e.value=n.value)),A((()=>t.value=o.value))}});Object.entries({position:"relative"}).forEach((e=>document.body.style.setProperty(e[0],e[1]))),async function(e,t=document.body){if(e instanceof Promise){const{ele:n,beforeMount:o,onMounted:i}=await e;return void(n&&t&&(o&&o(),t.appendChild(n),i&&i()))}const{ele:n,beforeMount:o,onMounted:i}=e;n&&t&&(o&&o(),t.appendChild(n),i&&i())}(o)}W("文章选读、视听学习 脚本注入成功"),window.addEventListener("load",(async()=>{N("load",(()=>{H("load",{data:!0,type:"runtime"})})),N("getData",(async({type:e,max:t})=>{if(e!==o.READ)if(e!==o.WATCH);else{const e=(await L("video",void 0,1e4))[0],n=(await L(".prism-play-btn",void 0,5e3))[0];if(!e||!n)return void H("getData",{type:"runtime",data:null});N("muted",(t=>{e.muted=t})),W("等待视频加载...");const o=setTimeout((()=>{W("视频加载超时!"),H("getData",{type:"runtime",data:null})}),1e4);e.addEventListener("canplay",(async()=>{clearTimeout(o);const{offsetHeight:n,offsetWidth:i}=I("body")[0],{innerHeight:r,innerWidth:a}=window,s=e.duration,u=~~(Math.min(s,t)+10*Math.random()-5);let c=!1;e.addEventListener("playing",(()=>{c=!0,W("视频播放中...")})),N("play",(()=>{H("play",{type:"runtime",data:c});const t=setInterval((()=>{if(c)return clearInterval(t),void N("pause",(t=>{t?e.pause():e.play()}));e.play()}),1e3)})),H("getData",{type:"runtime",data:{duration:u,height:n,width:i,innerWidth:a,innerHeight:r}})}))}else{const e=(await L(".main-view > section",void 0,5e3))[0];if(!e||e.innerText.includes("系统正在维护中"))return H("getData",{type:"runtime",data:null}),void W("未找到文章!");const n=60*Math.max(e.innerText.length,200)/1e3,o=~~(Math.min(n,t)+10*Math.random()-5),{offsetHeight:i,offsetWidth:r}=I("body")[0],{innerHeight:a,innerWidth:s}=window;H("getData",{type:"runtime",data:{duration:o,height:i,width:r,innerWidth:s,innerHeight:a}})}})),x(),window.addEventListener("beforeunload",(()=>{H("unload",{type:"runtime",data:null})}))}));
